# Git Hooks Configuration

This project uses Git hooks to enforce code quality and test standards.

## Current Hooks

### pre-commit (Active)
Runs **before** creating a commit. Currently configured to run:
1. ✅ Spotless auto-formatting
2. ✅ PMD static code analysis
3. ✅ Checkstyle code style checks
4. ⚠️ Unit tests (disabled by default - see below)

**Duration**: ~5-10 seconds

### pre-push (Active)
Runs **before** pushing to remote. Currently configured to run:
1. ✅ Full test suite (all tests including E2E)

**Duration**: ~3-5 minutes

## Enabling Unit Tests in Pre-Commit Hook

By default, unit tests are **disabled** in the pre-commit hook to keep commits fast. To enable them:

1. Edit `.git/hooks/pre-commit`
2. Uncomment lines 79-88 (the unit test section)
3. Save the file

**Trade-offs:**
- ✅ Catches test failures earlier
- ✅ Ensures all commits have passing tests
- ❌ Slows down commit workflow (adds ~1-2 minutes)
- ❌ May interrupt rapid prototyping

## Skipping Hooks (Emergency Use Only)

If you need to bypass hooks in an emergency:

```bash
# Skip pre-commit hook
git commit --no-verify -m "your message"

# Skip pre-push hook
git push --no-verify
```

⚠️ **Warning**: Skipping hooks may result in CI/CD failures. Use sparingly!

## Hook Behavior

### What Happens on Failure?

**Pre-commit failures:**
- Commit is blocked
- You must fix issues before committing
- Spotless auto-formatting is applied automatically

**Pre-push failures:**
- Push is blocked
- You must fix test failures before pushing
- Or use `--no-verify` (not recommended)

### Test Exclusions

- **Pre-commit** (when enabled): Excludes E2E tests tagged with `@Tag("e2e")`
- **Pre-push**: Runs ALL tests including E2E tests

## CI/CD vs Local Hooks

Both local hooks and CI/CD run the same checks, but:

- **Local hooks**: Immediate feedback, faster iteration
- **CI/CD**: Comprehensive checks, required for merge approval
- **Philosophy**: Catch issues locally before pushing

## Troubleshooting

### Hook not executing?
```bash
# Check if hook is executable
ls -l .git/hooks/pre-commit
ls -l .git/hooks/pre-push

# If not, make executable
chmod +x .git/hooks/pre-commit
chmod +x .git/hooks/pre-push
```

### Tests timing out?
- E2E tests require Docker services to be running
- Check `docker-compose ps` to verify services are up
- Run `docker-compose up -d` if needed

### Hooks too slow?
- Keep unit tests disabled in pre-commit hook
- Pre-push hook runs less frequently (only on push)
- Use `git commit --amend` to fix issues without re-running hook
